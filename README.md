# Rehash

> **⚠️ AI-Generated Project**: This project was entirely generated by Claude (Anthropic's AI assistant) as a demonstration of AI-powered software development. While functional and tested, please review the code before use in production environments.

A lightweight shell history manager with fuzzy search and directory-aware features.

## Features

- **Fuzzy Search**: Fast fuzzy matching similar to fzf
- **Three Search Scopes**: Global, session-based, and directory-local history
- **Cross-Shell Persistence**: History persists across different shell sessions in the same directory
- **Interactive UI**: Intuitive terminal interface with hotkey scope switching
- **Session Tracking**: Unique session IDs track commands across shell environments
- **Lightweight**: Minimal dependencies and fast startup

## Installation

### Using Nix (Recommended)

```bash
# Enter development environment
nix develop

# Build the project
cargo build --release

# Install binary
cp target/release/rehash ~/.local/bin/
```

### Manual Build

```bash
# Install Rust if not already installed
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# Build rehash
cargo build --release
cp target/release/rehash ~/.local/bin/
```

## Shell Integration

### Bash

Add to your `~/.bashrc`:

```bash
source /path/to/rehash/shell/rehash.bash
```

### Zsh

Add to your `~/.zshrc`:

```bash
source /path/to/rehash/shell/rehash.zsh
```

## Usage

### Key Bindings (after shell integration)

- `Ctrl+R`: Interactive fuzzy search (global history)
- `Ctrl+T`: Interactive fuzzy search (directory-local history)
- `Alt+R`: Interactive fuzzy search (current session history)

### Interactive Search Controls

- `F1`: Switch to Global scope (all commands)
- `F2`: Switch to Session scope (current session only)
- `F3`: Switch to Local scope (current directory only)
- `Tab`: Cycle through scopes (Global → Session → Local → Global)
- `↑/↓`: Navigate results
- `Enter`: Select command
- `Esc/Ctrl+C`: Exit

### Command Line Interface

```bash
# Add a command manually
rehash add "ls -la" --exit-code 0

# Search history with different scopes
rehash search "git"                    # global (default)
rehash search "git" --scope session    # current session only
rehash search "git" --scope local      # current directory only

# Interactive search with initial scope
rehash interactive                     # starts in global scope
rehash interactive --scope session    # starts in session scope
rehash interactive --scope local      # starts in local scope

# Interactive search with prefilled query
rehash interactive --prefix "git"     # starts with "git" in search box
rehash interactive --prefix "docker" --scope local  # prefix + scope

# Show statistics
rehash stats

# Clear history by scope
rehash clear --scope global           # clear all history
rehash clear --scope session          # clear current session
rehash clear --scope local            # clear current directory
```

## How It Works

### Search Scopes

- **Global**: All commands across all directories and sessions
- **Session**: Commands from current shell session across all directories
- **Local**: Commands from current directory (and subdirectories) across all sessions

### Prefix Integration

- **Shell Integration**: Automatically prefills search with current command line
- **Manual Usage**: Use `--prefix` parameter for custom prefill text
- **Incremental Search**: Start typing, press Ctrl+R, continue from where you left off

### Session Tracking

- Each rehash instance creates a unique session ID (`{PID}_{timestamp}`)
- Session IDs ensure history persistence across shell changes (e.g., `nix develop`)
- Commands are tagged with directory, session ID, timestamp, and exit code

### Storage

- History stored in `~/.local/share/rehash/history.jsonl`
- JSON Lines format for easy parsing and backup
- Automatic command capture via shell hooks


## Comparison with Atuin

| Feature | Rehash | Atuin |
|---------|--------|-------|
| Fuzzy Search | ✅ | ✅ |
| Directory-Local History | ✅ | Limited |
| Session-Based History | ✅ | ❌ |
| Cross-Shell Persistence | ✅ | ❌ |
| Interactive Scope Switching | ✅ | ❌ |
| Lightweight | ✅ | ❌ |
| Cloud Sync | ❌ | ✅ |
| Advanced Stats | ❌ | ✅ |